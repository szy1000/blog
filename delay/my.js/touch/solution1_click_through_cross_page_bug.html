<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <title>测试my.js的touch方法，解决跨页面点透问题</title>
    <script src="../my.js"></script>
    <script src="touch.js"></script>
    <style>
    em {
        display: block;
        color: red;
        font-style: normal;
    }
    .clickme {
        background-color: #eee;
        cursor: pointer;
        border: 1px solid red;
    }
    </style>
</head>
<body>
    <div id="console"></div>
    <script>
    function log() {
        var args = arguments;
        var str = '';

        var console = document.getElementById('console');

        for (var i = 0; i < args.length; i++) {
            str += args[i].toString();
            if (i < args.length - 1) {
                str += ', ';
            }
        }
        str += '<br>';

        console.innerHTML += str;
    }
    </script>
    <h1>测试my.js的touch方法，解决跨页面点透问题</h1>

    <h2>解法1：把a标签的href设置为#（或者类似的页内锚点跳转），然后js tap控制跳转，注意不能是js click控制，否则还会触发</h2>


    <div id="mask" style="display: none; position: fixed; top: 0; left: 0; z-index: 10; width: 100%; height: 1000px; background-color: #eee; text-align: center;">
        点击会消失
    </div>

    <h3>my.js: m$(str).tap(handler)</h3>
    <p id="ele_touch_tap2" class="clickme" style="height: 100px;">点击弹出mask，点击mask消失<em>且不跳转</em>，页面跳转则存在点透bug</p>
    <a id="a" href="#" style="display: inline-block; background-color: blue; width: 100%; height: 100px;">跳转链接，在mask弹出时点击此块区域，验证跨页面点透bug</a>
    <em></em>
    <script>
    function showMask() {
        m$('#mask').show().tap(function(e) {
            // alert(e.target.innerHTML);
            m$(this).hide();
        });
    }
    m$('#a').tap(function() {
        window.location.href = 'error.html';
    });
    m$('#ele_touch_tap2').tap(function() {
        showMask();
    });
    </script>

    
    <h3>zepto: $(str).tap(handler)</h3>
    <script src="lib/zepto116.min.js"></script>
    <script src="lib/zepto_touch.js"></script>
    <p id="ele_touch_tap3" class="clickme" style="height: 100px;">点击弹出mask，点击mask消失<em>且不跳转</em>，页面跳转则存在点透bug</p>
    <a id="a2" href="#" style="display: inline-block; background-color: blue; width: 100%; height: 100px;">跳转链接，在mask弹出时点击此块区域，验证跨页面点透bug</a>
    <em></em>
    <script>
    // 会出问题
    // $('#a2').click(function() {
    //     window.location.href = 'error.html';
    // });
    
    // 不会出问题
    $('#a2').tap(function() {
        window.location.href = 'error.html';
    });
    $('#ele_touch_tap3').tap(function() {
        showMask();
    });
    </script>
</body>
</html>